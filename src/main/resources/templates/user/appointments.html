<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<body>
<main layout:fragment="content">
    <div class="booking-container">
        <div class="booking-header d-flex align-items-center">
            <a href="/" class="text-white me-3 fs-5"><i class="fa-solid fa-arrow-left"></i></a>
            <h4 class="mb-0">Đặt lịch khám</h4>
        </div>

        <div class="booking-body">
            <!-- Chỉ báo các bước - Bước 1 được kích hoạt -->
            <form method="get" th:action="@{/user/dat-lich}">
                <div class="mb-4">
                    <select class="form-select" name="specialtyId" onchange="this.form.submit()">
                        <option value="" th:selected="${selectedSpecialtyId == null}">Tất cả chuyên khoa</option>
                        <option th:each="specialty : ${specialty}"
                                th:value="${specialty.id}"
                                th:text="${specialty.specialtyName}"
                                th:selected="${selectedSpecialtyId == specialty.id}">
                        </option>
                    </select>
                </div>
            </form>
            <!-- Nội dung Bước 1 -->
            <div id="doctorSelection" class="booking-step active">
                <!-- Ô tìm kiếm -->
                <form method="get" th:action="@{/user/dat-lich}">
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text bg-white"><i class="fa-solid fa-magnifying-glass"></i></span>
                            <input type="text" class="form-control" name="keyword" th:value="${keyword}" placeholder="Tìm kiếm bác sĩ theo tên...">
                            <button type="submit" class="btn btn-primary">Tìm</button>
                        </div>
                    </div>
                </form>

<!--                &lt;!&ndash; Dropdown chọn chuyên khoa &ndash;&gt;-->
<!--                <div class="mb-4">-->
<!--                    <select class="form-select" aria-label="Chọn chuyên khoa">-->
<!--                        <option value="" selected>Tất cả chuyên khoa</option>-->
<!--                        <option th:each="specialty : ${specialty}"-->
<!--                                th:value="${specialty.id}"-->
<!--                                th:text="${specialty.specialtyName}">-->
<!--                            Khoa Tim Mạch-->
<!--                        </option>-->
<!--                    </select>-->
<!--                </div>-->

                <!-- DANH SÁCH BÁC SĨ ĐỘNG -->
                <div class="row g-4" id="doctorList">

                    <!-- ======================================================= -->
                    <!-- BẮT ĐẦU: ÁP DỤNG LOGIC HIỂN THỊ TỪ ĐOẠN CODE 1 VÀO ĐÂY -->
                    <!-- ======================================================= -->

                    <!-- Vòng lặp th:each để lặp qua danh sách bác sĩ từ Controller -->
                    <div class="col-md-6 col-lg-4" th:each="doctor : ${doctors}">
                        <div class="card doctor-card h-100">

                            <!-- Dùng doctor.avatarUrl (Đúng, vì doctor là Doctor) -->
                            <img th:src="${doctor.avatarUrl != null and !doctor.avatarUrl.isEmpty()} ? @{/avatars/{fileName}(fileName=${doctor.avatarUrl})} : '...default.png'"
                                 class="card-img-top" alt="Ảnh bác sĩ">

                            <div class="card-body d-flex flex-column">
                                <!-- Dùng doctor.fullName (Đúng) -->
                                <h5 class="card-title fw-bold" th:text="${doctor.fullName}">...</h5>
                                <!-- Dùng doctor.specialization (Đúng) -->
                                <p class="card-text text-muted mb-3"
                                   th:text="${doctor.specialty?.specialtyName} ?: 'Chuyên khoa chưa cập nhật'">
                                </p>
                                <!-- Dùng doctor.userAccount.id (Đúng) -->
                                <a th:href="@{/user/dat-lich/chon-lich(doctorId=${doctor.userAccount.id})}" class="btn btn-primary w-100 mt-auto">Chọn</a>
                            </div>
                        </div>
                    </div>

                    <!-- ======================================================= -->
                    <!-- KẾT THÚC: PHẦN HIỂN THỊ ĐỘNG -->
                    <!-- ======================================================= -->

                </div>
            </div>
        </div>
    </div>
</main>
</body>
</html>